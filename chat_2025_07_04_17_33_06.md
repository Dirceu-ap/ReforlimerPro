1. **You**: adicionar consulta de movimentação de entrada e saida por fornecedor
2. **deepseek**: # Consulta de Movimentação de Entrada e Saída por Fornecedor

Vou criar uma consulta SQL que mostra as movimentações de entrada e saída agrupadas por fornecedor. Esta consulta pode ser útil para análise de estoque, fluxo de materiais e relacionamento com fornecedores.

## Opção 1: Consulta Básica

```sql
SELECT 
    f.id_fornecedor,
    f.nome AS nome_fornecedor,
    SUM(CASE WHEN m.tipo_movimentacao = 'entrada' THEN m.quantidade ELSE 0 END) AS total_entrada,
    SUM(CASE WHEN m.tipo_movimentacao = 'saida' THEN m.quantidade ELSE 0 END) AS total_saida,
    SUM(CASE WHEN m.tipo_movimentacao = 'entrada' THEN m.valor_total ELSE 0 END) AS valor_total_entrada,
    SUM(CASE WHEN m.tipo_movimentacao = 'saida' THEN m.valor_total ELSE 0 END) AS valor_total_saida
FROM 
    movimentacoes m
JOIN 
    fornecedores f ON m.id_fornecedor = f.id_fornecedor
GROUP BY 
    f.id_fornecedor, f.nome
ORDER BY 
    f.nome;
```

## Opção 2: Consulta Detalhada com Datas

```sql
SELECT 
    f.id_fornecedor,
    f.nome AS nome_fornecedor,
    DATE_FORMAT(m.data_movimentacao, '%Y-%m') AS mes_ano,
    SUM(CASE WHEN m.tipo_movimentacao = 'entrada' THEN m.quantidade ELSE 0 END) AS total_entrada,
    SUM(CASE WHEN m.tipo_movimentacao = 'saida' THEN m.quantidade ELSE 0 END) AS total_saida,
    SUM(CASE WHEN m.tipo_movimentacao = 'entrada' THEN m.valor_total ELSE 0 END) AS valor_total_entrada,
    SUM(CASE WHEN m.tipo_movimentacao = 'saida' THEN m.valor_total ELSE 0 END) AS valor_total_saida
FROM 
    movimentacoes m
JOIN 
    fornecedores f ON m.id_fornecedor = f.id_fornecedor
GROUP BY 
    f.id_fornecedor, f.nome, DATE_FORMAT(m.data_movimentacao, '%Y-%m')
ORDER BY 
    mes_ano, f.nome;
```

## Opção 3: Consulta com Produtos (Detalhamento)

```sql
SELECT 
    f.id_fornecedor,
    f.nome AS nome_fornecedor,
    p.id_produto,
    p.descricao AS descricao_produto,
    SUM(CASE WHEN m.tipo_movimentacao = 'entrada' THEN m.quantidade ELSE 0 END) AS total_entrada,
    SUM(CASE WHEN m.tipo_movimentacao = 'saida' THEN m.quantidade ELSE 0 END) AS total_saida
FROM 
    movimentacoes m
JOIN 
    fornecedores f ON m.id_fornecedor = f.id_fornecedor
JOIN 
    produtos p ON m.id_produto = p.id_produto
GROUP BY 
    1, 2, 3, 4
ORDER BY 
    2, 4;
```

## Implementação em Aplicação

Se você estiver implementando isso em uma aplicação (PHP por exemplo):

```php
// Exemplo em PHP usando PDO para buscar movimentações por fornecedor

function getMovimentacoesPorFornecedor($periodoInicio = null, $periodoFim = null) {
    
$dbh = new PDO('mysql:host=localhost;dbname=estoque', 'usuario', 'senha');
    
$sql = "SELECT f.id_fornecedor, f.nome as nome_fornecedor, ..."; // Use uma das consultas acima
    
$params = [];
    
if ($periodoInicio && $periodoFim) {
        $sql .= " WHERE data_movimentacao BETWEEN :inicio AND :fim";
        $params[':inicio'] = $periodoInicio;
        $params[':fim'] = $periodoFim;
}
    
$stmt->execute($params);
return $stmt->fetchAll(PDO::FETCH_ASSOC);
}
```

Você pode adaptar essas consultas conforme a estrutura do seu banco de dados e necessidades específicas de relatório.